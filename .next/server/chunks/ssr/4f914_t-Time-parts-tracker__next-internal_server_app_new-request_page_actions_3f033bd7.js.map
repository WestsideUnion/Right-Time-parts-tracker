{"version":3,"sources":["../../../../../../../Documents/GitHub/Right-Time-parts-tracker/app/actions/requests.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { RequestItemInput } from '@/lib/types';\nimport { revalidatePath } from 'next/cache';\n\nexport async function createRequest(items: RequestItemInput[], notes?: string) {\n    const supabase = await createClient();\n\n    // Get current user\n    const {\n        data: { user },\n        error: authError,\n    } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n        return { error: 'Not authenticated' };\n    }\n\n    // Validate items\n    if (!items || items.length === 0) {\n        return { error: 'At least one item is required' };\n    }\n\n    for (const item of items) {\n        if (!item.job_bag_number?.trim()) {\n            return { error: 'Job bag number is required for all items' };\n        }\n        if (!item.manufacturer?.trim()) {\n            return { error: 'Manufacturer is required for all items' };\n        }\n        if (!item.part_name?.trim()) {\n            return { error: 'Part name is required for all items' };\n        }\n        if (!item.quantity || item.quantity < 1) {\n            return { error: 'Quantity must be at least 1 for all items' };\n        }\n    }\n\n    // Create request\n    const { data: request, error: requestError } = await supabase\n        .from('requests')\n        .insert({\n            created_by: user.id,\n            notes: notes || null,\n        })\n        .select()\n        .single();\n\n    if (requestError) {\n        console.error('Error creating request:', requestError);\n        return { error: 'Failed to create request' };\n    }\n\n    // Create request items\n    const itemsToInsert = items.map((item) => ({\n        request_id: request.id,\n        job_bag_number: item.job_bag_number.trim(),\n        manufacturer: item.manufacturer.trim(),\n        part_name: item.part_name.trim(),\n        description: item.description?.trim() || null,\n        quantity: item.quantity,\n        created_by: user.id,\n    }));\n\n    const { error: itemsError } = await supabase\n        .from('request_items')\n        .insert(itemsToInsert);\n\n    if (itemsError) {\n        console.error('Error creating items:', itemsError);\n        // Try to delete the request since items failed\n        await supabase.from('requests').delete().eq('id', request.id);\n        return { error: 'Failed to create items' };\n    }\n\n    revalidatePath('/receiving');\n    revalidatePath('/pick-list');\n\n    return { success: true, requestId: request.id };\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAc,CAAyB,CAAE,CAAc,EACzE,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAG7B,CACF,KAAM,MAAE,CAAI,CAAE,CACd,MAAO,CAAS,CACnB,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GAE/B,GAAI,GAAa,CAAC,EACd,IADoB,EACb,CAAE,MAAO,mBAAoB,EAIxC,GAAI,CAAC,GAA0B,GAAG,CAApB,EAAM,MAAM,CACtB,MAAO,CAAE,MAAO,+BAAgC,EAGpD,IAAK,IAAM,KAAQ,EAAO,CACtB,GAAI,CAAC,EAAK,cAAc,EAAE,OACtB,CAD8B,KACvB,CAAE,MAAO,0CAA2C,EAE/D,GAAI,CAAC,EAAK,YAAY,EAAE,OACpB,CAD4B,KACrB,CAAE,MAAO,wCAAyC,EAE7D,GAAI,CAAC,EAAK,SAAS,EAAE,OACjB,CADyB,KAClB,CAAE,MAAO,qCAAsC,EAE1D,GAAI,CAAC,EAAK,QAAQ,EAAI,EAAK,QAAQ,CAAG,EAClC,CADqC,KAC9B,CAAE,MAAO,2CAA4C,CAEpE,CAGA,GAAM,CAAE,KAAM,CAAO,CAAE,MAAO,CAAY,CAAE,CAAG,MAAM,EAChD,IAAI,CAAC,YACL,MAAM,CAAC,CACJ,WAAY,EAAK,EAAE,CACnB,MAAO,GAAS,IACpB,GACC,MAAM,GACN,MAAM,GAEX,GAAI,EAEA,OADA,KADc,GACN,KAAK,CAAC,0BAA2B,GAClC,CAAE,MAAO,0BAA2B,EAI/C,IAAM,EAAgB,EAAM,GAAG,CAAC,AAAC,IAAU,CACvC,EADsC,SAC1B,EAAQ,EAAE,CACtB,eAAgB,EAAK,cAAc,CAAC,IAAI,GACxC,aAAc,EAAK,YAAY,CAAC,IAAI,GACpC,UAAW,EAAK,SAAS,CAAC,IAAI,GAC9B,YAAa,EAAK,WAAW,EAAE,QAAU,KACzC,SAAU,EAAK,QAAQ,CACvB,WAAY,EAAK,EAAE,CACvB,CAAC,EAEK,CAAE,MAAO,CAAU,CAAE,CAAG,MAAM,EAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,UAEZ,AAAI,GACA,QAAQ,CADI,IACC,CAAC,wBAAyB,GAEvC,MAAM,EAAS,IAAI,CAAC,YAAY,MAAM,GAAG,EAAE,CAAC,KAAM,EAAQ,EAAE,EACrD,CAAE,MAAO,wBAAyB,IAG7C,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,cACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,cAER,CAAE,SAAS,EAAM,UAAW,EAAQ,EAAE,AAAC,EAClD,yCA1EsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}