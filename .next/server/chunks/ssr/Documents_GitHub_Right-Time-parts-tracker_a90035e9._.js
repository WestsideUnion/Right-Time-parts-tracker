module.exports=[19279,36820,a=>{"use strict";var b=a.i(51548),c=a.i(14656),d=a.i(69439),e=a.i(9303);async function f(a,b){let{data:c}=await b.from("user_roles").select("role").eq("user_id",a).single();return c?.role}async function g(a,b,c,d,e,f){await a.from("audit_logs").insert({request_item_id:b,field_changed:c,old_value:d,new_value:e||"pending",changed_by:f})}async function h(a,b){let e=await (0,c.createClient)(),{data:{user:h},error:i}=await e.auth.getUser();if(i||!h)throw Error("Not authenticated");if("boss"!==await f(h.id,e))throw Error("Only boss can update boss status");let{data:j}=await e.from("request_items").select("boss_status").eq("id",a).single(),{error:k}=await e.from("request_items").update({boss_status:b}).eq("id",a);if(k)throw console.error("Error updating boss status:",k),Error("Failed to update status");return await g(e,a,"boss_status",j?.boss_status,b,h.id),(0,d.revalidatePath)("/pick-list"),(0,d.revalidatePath)("/receiving"),{success:!0}}async function i(a,b){let e=await (0,c.createClient)(),{data:{user:h},error:i}=await e.auth.getUser();if(i||!h)throw Error("Not authenticated");let j="true"===process.env.ADMIN_CAN_MODIFY_STAFF_STATUS,k=await f(h.id,e);if("staff"!==k&&!("boss"===k&&j))throw Error("Only staff can update staff status");let{data:l}=await e.from("request_items").select("boss_status, staff_status").eq("id",a).single();if(l?.boss_status==="discontinued"&&"staff"===k)throw Error("Cannot update discontinued items");let m={staff_status:b};"installed"===b?m.installed_at=new Date().toISOString():m.installed_at=null;let{error:n}=await e.from("request_items").update(m).eq("id",a);if(n)throw console.error("Error updating staff status:",n),Error("Failed to update status");return await g(e,a,"staff_status",l?.staff_status,b,h.id),(0,d.revalidatePath)("/pick-list"),(0,d.revalidatePath)("/receiving"),{success:!0}}async function j(a,b){let e=await (0,c.createClient)(),{data:{user:h},error:i}=await e.auth.getUser();if(i||!h)throw Error("Not authenticated");if("boss"!==await f(h.id,e))throw Error("Only boss can update boss status");let{data:j}=await e.from("request_items").select("id, boss_status").in("id",a),{error:k}=await e.from("request_items").update({boss_status:b}).in("id",a);if(k)throw console.error("Error bulk updating boss status:",k),Error("Failed to update statuses");if(j)for(let a of j)await g(e,a.id,"boss_status",a.boss_status,b,h.id);return(0,d.revalidatePath)("/pick-list"),(0,d.revalidatePath)("/receiving"),{success:!0}}async function k(a,b){let{data:c}=await b.from("user_roles").select("role").eq("user_id",a).single();return c?.role}async function l(a){let b=await (0,c.createClient)(),{data:{user:e},error:f}=await b.auth.getUser();if(f||!e)throw Error("Not authenticated");if("system_admin"!==await k(e.id,b))throw Error("Only system admin can delete items");let{error:g}=await b.from("request_items").delete().eq("id",a);if(g)throw console.error("Error deleting item:",g),Error("Failed to delete item");return(0,d.revalidatePath)("/pick-list"),(0,d.revalidatePath)("/receiving"),{success:!0}}async function m(a){let b=await (0,c.createClient)(),{data:{user:e},error:f}=await b.auth.getUser();if(f||!e)throw Error("Not authenticated");if("system_admin"!==await k(e.id,b))throw Error("Only system admin can delete items");let{error:g}=await b.from("request_items").delete().in("id",a);if(g)throw console.error("Error bulk deleting items:",g),Error("Failed to delete items");return(0,d.revalidatePath)("/pick-list"),(0,d.revalidatePath)("/receiving"),{success:!0}}(0,e.ensureServerEntryExports)([h,i,j]),(0,b.registerServerReference)(h,"60f1ae99487034e3add282dc86cabe0168420d0dfe",null),(0,b.registerServerReference)(i,"603bc9c1796a7171c7c35f5d7b98d44b8252b48f8f",null),(0,b.registerServerReference)(j,"60aba6e1bead894c20c928b2c9507ea0a1438a7a18",null),a.s(["bulkUpdateBossStatus",()=>j,"updateBossStatus",()=>h,"updateStaffStatus",()=>i],19279),(0,e.ensureServerEntryExports)([l,m]),(0,b.registerServerReference)(l,"40605760b4b2861f02c3e9b7270eb1eb8b0c7420b3",null),(0,b.registerServerReference)(m,"40de1e46b98bfcdbc8e66fa18ffa3a74f84d1d9fb4",null),a.s(["bulkDeleteItems",()=>m,"deleteItem",()=>l],36820)},51498,a=>{"use strict";var b=a.i(19279),c=a.i(36820);a.s([],40269),a.i(40269),a.s(["40605760b4b2861f02c3e9b7270eb1eb8b0c7420b3",()=>c.deleteItem,"603bc9c1796a7171c7c35f5d7b98d44b8252b48f8f",()=>b.updateStaffStatus,"60f1ae99487034e3add282dc86cabe0168420d0dfe",()=>b.updateBossStatus],51498)}];

//# sourceMappingURL=Documents_GitHub_Right-Time-parts-tracker_a90035e9._.js.map